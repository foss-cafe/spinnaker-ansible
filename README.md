# Ansible Playbook for Spinnaker

Ansible Playbook for installing and configuring Spinnaker

## For Local Development

### Required tools

- Vagrant - `>= 2.2.2`
- Ansible - `>=2.9.2`
- Virtualbox

### Adding Vagrant box to Local environment

```bash
vagrant box add ubuntu/bionic64
```

Verify Vagrant box is updated

```bash
 vagrant box list
generic/rhel7   (virtualbox, 1.9.40)
suse13          (virtualbox, 0)
ubuntu/bionic64 (virtualbox, 20191218.0.0)
ubuntu/xenial64 (virtualbox, 20191105.0.0)
ubuntu/xenial64 (virtualbox, 20191204.0.0)
ubuntu/xenial64 (virtualbox, 20191211.0.0)
```

Start your VM

You can tune your VM configs by updating `Vagrantfile`.

### Install hal

```bash
ansible-playbook install_hal.yml

PLAY [apply common configuration to all nodes] *********************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [docker : install aptititude] *********************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [docker : Update all packages to the latest version] **********************************************************************************************************************************************************************
[WARNING]: The value True (type bool) in a string field was converted to 'True' (type string). If this does not look like what you expect, quote the entire value to ensure it does not change.

ok: [192.168.33.11]

TASK [docker : Install a list of packages] *************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [docker : Add an Apt signing key, uses whichever key is at the URL] *******************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [docker : apt_repository] *************************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [docker : Run the equivalent of "apt-get update" as a separate step] ******************************************************************************************************************************************************
changed: [192.168.33.11]

TASK [docker : Install a list of packages for Docker] **************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [docker : ensure docker is running] ***************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [kubectl : Update all packages to the latest version] *********************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [kubectl : Install a list of packages] ************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [kubectl : Add an Apt signing key, uses whichever key is at the URL] ******************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [kubectl : apt_repository] ************************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [kubectl : Run the equivalent of "apt-get update" as a separate step] *****************************************************************************************************************************************************
changed: [192.168.33.11]

TASK [kubectl : Install a list of packages for Kubectl and dependencies] *******************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [kubectl : Copy SSH Banner to Server] *************************************************************************************************************************************************************************************
changed: [192.168.33.11]

TASK [awscli : Apt update cache] ***********************************************************************************************************************************************************************************************
changed: [192.168.33.11]

TASK [awscli : Installing python3 and pip] *************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [awscli : Installing awscli] **********************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [hal : Getting installation script] ***************************************************************************************************************************************************************************************
ok: [192.168.33.11]

TASK [hal : Running installation script] ***************************************************************************************************************************************************************************************
changed: [192.168.33.11]

TASK [hal : Updating halyard] **************************************************************************************************************************************************************************************************
changed: [192.168.33.11]

PLAY RECAP *********************************************************************************************************************************************************************************************************************
192.168.33.11              : ok=22   changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```

Once `hal` is installed Run next pipeline to set the configs

```bash
cp group_vars/all.example group_vars/all
```

- Update group_vars/all variables file
  Run next Playbook

```bash
ansible-playbook hal_config.yml
```

Once the configs are set you can login to remote server and do `hal deploy apply` as `ubuntu` user
